{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.tslstudio.dev/codex-task.json",
  "title": "TSLStudio Codex Task",
  "description": "Schema describing a work item for Codex-driven automation aligned with the TSLStudio PRD and implementation plan.",
  "type": "object",
  "required": [
    "id",
    "title",
    "phase",
    "week",
    "category",
    "status",
    "sourceReferences",
    "target",
    "acceptanceCriteria"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^TSL-[0-9]{3,}$",
      "description": "Stable identifier used for cross referencing tasks and dependencies."
    },
    "title": {
      "type": "string",
      "minLength": 4,
      "description": "Concise, human readable summary of the task."
    },
    "summary": {
      "type": "string",
      "description": "Detailed description of the work required."
    },
    "phase": {
      "type": "string",
      "enum": [
        "foundation-migration",
        "noise-materials",
        "post-screen-space",
        "compute-simulation",
        "polish-qa"
      ],
      "description": "Program phase derived from the implementation plan."
    },
    "week": {
      "type": "integer",
      "minimum": 1,
      "maximum": 20,
      "description": "Scheduled week in the 20 week roadmap."
    },
    "category": {
      "type": "string",
      "enum": [
        "foundation",
        "noise",
        "materials",
        "post",
        "compute",
        "presets",
        "docs",
        "qa",
        "infrastructure"
      ],
      "description": "Discipline grouping used for reporting."
    },
    "status": {
      "type": "string",
      "enum": [
        "planned",
        "in-progress",
        "blocked",
        "complete"
      ],
      "description": "Execution status for the task."
    },
    "priority": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low"],
      "default": "medium"
    },
    "sourceReferences": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["repository", "path"],
        "properties": {
          "repository": {
            "type": "string",
            "description": "Name of the upstream repository that will be ported."
          },
          "path": {
            "type": "string",
            "description": "Path within the repository for the canonical implementation."
          },
          "artifactType": {
            "type": "string",
            "enum": ["noise", "material", "post", "compute", "utility", "docs", "schema"],
            "description": "Classification for the referenced artifact."
          },
          "notes": {
            "type": "string"
          }
        },
        "additionalProperties": false
      },
      "description": "List of upstream implementations being adopted."
    },
    "target": {
      "type": "object",
      "required": ["package", "module"],
      "properties": {
        "package": {
          "type": "string",
          "pattern": "^@?tslstudio/.*$",
          "description": "Published package that will host the ported code."
        },
        "module": {
          "type": "string",
          "description": "Path within the target package (e.g. materials/core/diffuseNode)."
        },
        "exports": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "schemaRef": {
          "type": "string",
          "description": "Pointer to an associated JSON schema used for validation."
        }
      },
      "additionalProperties": false
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^TSL-[0-9]{3,}$"
      },
      "description": "List of other tasks that must complete first."
    },
    "acceptanceCriteria": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "string",
        "minLength": 4
      },
      "description": "Observable exit conditions that guarantee success."
    },
    "qa": {
      "type": "object",
      "properties": {
        "tests": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "metrics": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name", "target"],
            "properties": {
              "name": { "type": "string" },
              "target": { "type": "string" },
              "measurement": { "type": "string" }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "notes": {
      "type": "string"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string"
      }
    }
  },
  "additionalProperties": false
}
